# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

# VPN Appliance Forensics

Авторы: 
BENJAMIN BRUPPACHER

Ссылка на контент: 
https://blog.compass-security.com/2022/03/vpn-appliance-forensics/

Краткое содержание: 

<blockquote>
After isolating the VPN Appliance from the Internet and from the internal Network, the customer gave us the credentials for the web based administration interface.     ...      The feature downloads a ZIP file containing interesting logs of the system and an export of its configuration:     ...      assigned IP address from the VPN IP address pool username source IP address from where the connection was established 2021-11-26 09:28:06:mcd 23888: MCD launched [RIP:10.100.132.100;UNAME:xyz;CIP:[CUT-BY-COMPASS]] 2021-11-26 09:28:08:mcd 23888: SSL VPN: Connected 2021-11-26 10:11:08:mcd 23888: Signal Recd (2).     ...      The appliance was not on the company’s inventory and therefore they were not aware that an EOL device was running in their network.     ...      If there is a session on the device, the encrypted password is returned in the supportcode JavaScript variable:     ...      This means, the appliance is probably not vulnerable for this vulnerability.     ...      Here the attackers seemed to exploit a command injection vulnerability in the MAC address field of a Wake-On-Lan feature of the RDP Bookmark.     ...      On the line that starts with HTTP_USER_AGENT, spaces break the shell statement and triggers an error in the log that can be used an an IOC:     ...      Because bookmarks can be created by standard SSL VPN users, this attack can be used to elevate privileges and extract the appliance configuration that holds interesting information and potentially other credentials.     ...      The next important step was to check the system in depth to see which credentials were stored and potentially could be obtained by the attacker.     ...      This shell is running under user nobody.     ...      This means not all files on the system can be accessed:     ...      The password is encrypted with the same hardcoded key as for the sessions above and therefore must be seen as compromised.     ...      This may be a factory default, but is not exploitable, since the root user can’t be used to logon to the system.     ...      Generally the following actions can be recommended if a VPN appliance is found to be compromised:     ...      Perform the revers shell attack to export the temp.db and check for stored credentials that can be easily decrypted.     ...      (No root shell access is required for this, as the database is readable by the nobody user.)     ...      Through Windows credentials dumping they obtained the Domain Admin credentials, which unfortunately were the same used for the root user of the ESXi server.     ...      Therefore the attackers were able to logon to the ESXi Hypervisor and ran the LockBit 2.0 Ransomware.     ...      You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc.     ...     
</blockquote>

---

