# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

# No Passwords More Problems

Авторы: 
PHILIPP MAO

Дата: 

Теги: 
None

Ссылка на контент: 
https://blog.compass-security.com/2022/06/no-passwords-more-problems/
Краткое содержание: 

<blockquote>
It is about a specific class of products, which I will call passwordless products, that allow users to login to any domain joined PC using only their smartphone.<br> 
The general architecture involves three parties: the smartphone on which the product specific app is installed, the computer on which the product is installed and an on-prem or cloud server, which facilitates the communication between the smartphone and the PC.<br> 
When a user logs in with one of these passwordless products this is also the case, and the described products do not modify how authentication is done in the Active Directory environment.<br> 
The implementation on the computer is done with a custom Windows credential provider and a service.<br> 
When a user logs into a computer, the user enters the username, gets a login notification on the app and after accepting the notification, if it’s the first time the user logs into that computer, the user has to enter the password.<br> 
When a user logs in the first time to a computer, the SafeNet credential provider encrypts the user’s password and writes it to a file.<br> 
Since the file is readable for all users I investigated how the passwords were encrypted, as a vulnerability there, could allow any user to decrypt the passwords of other users.<br> 
The entropy value used in the encryption and decryption of the passwords.<br> 
These together result in a vulnerability (published as CVE-2021-42138), which allows any user on the machine to decrypt the passwords stored in the file, including the password of other users.<br> 
Since the Credential Provider DLL is loaded into the logon window process the encryption/decryption of the passwords is done with the permissions of that process.<br> 
Passwordless login for “run as different user” would not work if the file containing the encrypted passwords was only readable by the SYSTEM user, since on this login, the DLL will be running with the permissions of a normal user.<br> 
When the user logs into a computer, the user enters the username, gets a login notification on the app and is logged in.<br> 
This login certificate is passed to the VeridiumAD service, which in turn sends it to the VeridiumAD credential provider and then to the login process.<br> 
The login process of VeridiumAD Vulnerability<br> 
However, this CSR HTTP request can be made by any domain user.<br> 
This vulnerability then allows for any user to potentially obtain the login certificate of all other user’s if they fall for the malicious push notification.<br> 
Afterwards the user gets a button in his HYPR app to log in as the current user for that computer.<br> 
The HYPR service on the computer continuously polls the cloud server and if the user authorizes a login in the app, the app sends the encrypted login certificate to the cloud server, which then forwards the certificate to the client as part of a polling response,.<br> 
On the client the certificate is decrypted by the HYPR service and passed to the login process.<br> 
The HYPR login process.<br> 
This stolen encrypted login certificate can be leveraged to login as another user.<br> 
The attack scenario is that an attacker has code execution as a low privileged user and is looking to login as another user (referred to as the target user), who uses HYPR to log in to that computer.<br> 
If the target user clicks the login button in their HYPR app for that computer, the attacker obtains the encrypted login certificate of the target user.<br> 
the attacker starts a login process on his own HYPR app, which the attacker enrolled for the low-privileged user on the computer, modifies the parameters sent to the HYPR cloud server in step 2 to start a login process for the target user on the computer and then sends the stolen encrypted login certificate of the target user to the server in step 3.<br> 
This encCounter value is sent to the app after the login flow is started and also to the HYPR service in the polling response containing the encrypted login certificate.<br> 
The app takes the encCounter value prepends it to the login certificate, encrypts that data and sends it to the server.<br> 
The HTTP response sent by the server to the app, setting the EncCounter value, which the app will use to encrypt the user’s certificate.<br> 
The polling response containing the encrypted login certificate and the encCounter.<br> 
With the values in the registry it is possible to deregister the target user from the computer.<br> 
Afterwards the attacker starts a login process on the computer (in this case a UAC login prompt) and starts a login process on the app.<br> 
This certificate is now sent as the polling response to the HYPR service by the server.<br> 
For all tested products there is a new way to obtain login credentials of other users as a local Administrator.<br> 
</blockquote>

---

